<!--
 * @Description: file content
 * @Author: RongWei
 * @Date: 2020-01-02 19:28:41
 * @LastEditors  : RongWei
 * @LastEditTime : 2020-01-02 20:11:17
 -->

## async 和 defer
相同点：
- ***加载文件*** 时不阻塞页面渲染（async 在执行脚本时会阻塞页面）
- 只对外部脚本有效

不同点：
- 浏览器兼容性不同
- `async` 在下载结束后立即执行；`defer` 则延迟到文档完全被解析和显示之后再执行
- 多个 `async` 脚本之间执行顺序无法保证，先下载完的先执行；多个 `defer` 脚本，执行顺序按照他们在文档中出现的先后顺序
- `async` 会在 `window` 的 `load` 事件之前执行，但不能保证在 `document` 的 `DOMContentLoaded`之前执行；`defer` 会在 `document` 的 `DOMContentLoaded` 和 `window` 的 `load` 事件之前执行

**确保只有一个`<script>` 标签指定了`async` 属性，或者指定了该属性的脚本，彼此之间没有依赖关系**

## 页面的加载和渲染过程
- 浏览器通过 `http`协议请求服务器获取 `html`，并从上到下解析，构建 `DOM` 树
- 解析过程中遇到外链的 `css` 或 `js` 脚本文件，则暂停页面解析，下载相应的 `css` 或 `js` 脚本文件
- `css` 文件下载完成后，构建 `CSSOM` 树，脚本文件下载完成后，解析并执行。之后继续解析文档
- 文档解析完成后，将 `DOM` 和 `CSSOM` 进行关联和映射，最后将视图渲染到浏览器窗口
  - 若存在 `async` 属性的脚本，文档的解析不会停止，会起其他的线程下载脚本；脚本下载完成后，暂停文档解析，执行脚本。
  - 若存在 `defer` 属性的脚本，文档解析不会停止，会起其他的线程下载脚本。等到文档解析完毕后，再执行脚本 


